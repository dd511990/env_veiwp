## 基本操作示例

​	视觉分析一般操作过程涉及环境模型构建、采样、视觉分析、分析结果展示四个阶段。研究开发的env_viewper主要负责“视觉分析”阶段，其他阶段可根据数据和操作需求选择事宜软件。唯一需要保持一致的是无论是使用点云（须转Mesh）、SketchUp、3DSMax还是Rhino等软件去创建三维环境，最终均要导入Blender去加载三维模型以便env_viewper进行分析。

​	由于开发者为建筑、规划、风景园林相关专业背景，因而这里仅以本领域研究、实践最常使用的CAD、SketchUp、ArcGIS等软件作为模型构建、采样以及分析结果展示的工具平台，以此展示Env_ViewP视觉分析的基本应用操作。

### 目录

[TOC]

### 0 、试用程序及附带文件说明

**下载地址：**

[阿里云]( https://www.aliyundrive.com/s/BRnbM5fejeG )

[百度云](https://pan.baidu.com/s/1FFc9AqPnGoE7Zu8Phgbe1g )





github（审稿期间暂不公开）:

https://github.com/dd511990/env_veiwp



为了熟悉流程，本【教程说明】所在文件夹提供了所需的主要程序和过程文件，具体内容详见下表。其中带有“【】”符号的为必须原始文件，其他文件和文件夹均为过程结果文件以供参考。

> 附带文件（夹）表

| 文件（夹）名称    | 类型       | 用途                                             |
| :---------------- | ---------- | ------------------------------------------------ |
| 【Env_ViewP.exe】 | 可执行文件 | 视觉分析文件                                     |
| 【Blender2.83】   | 文件夹     | 编译后的Blender三维模型制作程序                  |
| 【skp】           | 文件夹     | 原始SketchUp模型                                 |
| 3ds               | 文件夹     | SU模型导出结果                                   |
| blend             | 文件夹     | “环境模型构建”.blend结果                         |
| dwg               | 文件夹     | “空间采样”CAD预处理部分导出与结果文件            |
| shp               | 文件夹     | “空间采样”中ArcGIS矢量过程数据                   |
| csv               | 文件夹     | “空间采样”采样点数据结果                         |
| settings          | 文件夹     | “视觉分析”阶段程序“视野控制”与“个体特征”配置文件 |
| 【00教程说明】    | pdf        | 本说明文件                                       |
| md                | 文件夹     | 本说明文件md                                     |



### 1、环境模型构建（.skp to .blend)

​	建筑、规划和风景园林等设计领域通常使用SketchUp进行建筑、环境模型的空间构建。其主要原因是SketchUp抛弃了对于复杂曲面、曲线等在简单建筑体块中罕见的几何特征的支持，因而具有与传统建筑设计相一致的从平面到体块的设计逻辑，以及简单的”封面-推拉”的模型构建模式。但这与以3DSMax、MAYA、Rhino等为代表的主流三维（动画）模型制作软件的操作习惯与逻辑极为不符，除此之外SketchUp特有的双面材质（一个平面分正反两面并具有不同材质），由其导出的模型在其他三维模型软件中往往会发生错误。

​	本研究使用Blender作为环境三维模型的整合、编辑工具。主要原因是其开源性：一方面方便进行适宜视觉量化的编译和脚本注入；另一方面极大的降低了研究成本。由于开源性，Blender具有良好的社区支持和丰富的插件、工具，几乎可以替代市面上任何商用三维软件的模型（动画）制作和参数化设计的作用，同时也几乎能够支持所有三维模型格式。但其频繁的版本更新以及复杂的功能与操作逻辑，对于依赖SketchUp的建筑、规划和风景园林等空间设计专业极不友好。

​	综上，本部分主要介绍SketchUp模型转换至Blender的方法，以此降低建筑、规划和风景园林等领域的学习成本。

#### 1.1  SketchUp模型预处理

​	将SketchUp模型需要分开进行量化处理的景观元素【创建组群】，并在【图元信息面板】中自定义名称（之后如果熟练Blender操作的话也可在Blender中进行）。

![1-SU编组更名](说明.assets\1-SU编组更名.png)

> 1-SU编组更名

#### 1.2 导出3ds格式模型

​	SU与Blender有很多共同支持格式（dae、fbx、stl等），但由于双面材质的问题，经实践发现只有3ds格式能够完全避免导入Blender后双面材质发生的显示问题。SU模型导出可以整体导出，亦可以逐个部分导出（便于Blender中进一步编组优化），这里仅展示整体导出。SketchUp中选择【导出】-【三维模型】。

![2-选择导出三维模型](说明.assets\2-选择导出三维模型.png)

> 2-选择导出三维模型

​	选择存储目录设置好文件名后，在保存类型中选择【3DS文件】

![3-选择3ds格式](说明.assets\3-选择3ds格式.png)

> 3-选择3ds格式

​	在【选项】中如下图所示进行【3DS导出选项】设置后导出.3ds格式模型

![4-设置3DS导出选项](说明.assets\4-设置3DS导出选项.png)

> 4-设置3DS导出选项

#### 1.3 设置并导入Blender

​	由于.3ds本身是一种较为古老的三维模型格式，在MESH支持上较为落后（但对于空间设计学科一般足够了），因而Blender在2.79版本之后取消了原生的.3ds格式。研究重新编译的Blender版本为2.83，因为需要通过插件的形式增加.3ds的导入选项，具体方式如下（这里仅展示默认英文UI，习惯中文的可调整偏好为中文即可）。

​	打开Blender后，在【Edit】中找到【Preferences】进行偏好设置。

![6-blender偏好设置](说明.assets\6-blender偏好设置.png)

> 5-blender偏好设置

​	在【Blender Preferences】窗口中选择【Add-ons】插件标签页，在面板中点击【Testing】。

![7-找到插件选项](说明.assets\7-找到插件选项.png)

> 6-找到插件选项

​	在搜索栏中输入“3ds”，选中下图所示插件，关闭【Blender Preferences】窗口

![8-开启支持导入3ds插件](说明.assets\8-开启支持导入3ds插件.png)

> 7-开启支持导入3ds插件

此时【File】中的【Import】导入选项中已有【3D Studio】选项，点击后进入导入页面。

![9-选择导入3ds](说明.assets\9-选择导入3ds.png)

> 8-选择导入3ds

​	在导入界面中通过左侧文档目录找到模型存储地址，找到存储的文件后修改右侧的**【Size Constraint】（缩放比例）为1000**（否则无法按照正常比例导入），后选择SU导出的模型文件进行导入（【Import 3DS】）

![10-找到3ds文件并修改缩放比例](说明.assets\10-找到3ds文件并修改缩放比例-1664940202328.png)

> 9-找到3ds文件并修改缩放比例

#### 1.4 Blender中模型预处理

​	导入Blender后，在右侧场景窗口中可以发现整个模型原SU中的所有组群组成一个名为“Model”的父级模型物体中，若此时进行分析则只会将整个模型视为一个物体。可右键点击“Model”选择【Select Hierarchy】实现所有层级选择，或展开后通过按住键盘shift点击的方式选择所有子物体，键盘alt + P 在弹出的窗口中 选择 【Clear and Keep Transformation】（清除父级保留变换），此时所有子物体位于与原父级物体同一级别中

![](说明.assets\11-清除父级-1664941830192.png)

> 10-清除父级

​	此时可进一步通过模型视口中直接点击模型，再在右侧场景列表中选择蓝色高亮模型物体，F2更改模型物体名称。另外若如下图选中的草地，为一个整体模型中的一部分，则右侧窗口其父级物体（Group5)不会显示蓝色高亮，仅在右侧子物体数角标处显示高亮，此时依然可以选择父级物体并更改名称。更多Blender物体合并、拆解、编辑的方式可在Blender官方社区或B站等视频网站的教程中获取相关基本操作。

![12-选择物体更改名称](说明.assets\12-选择物体更改名称-1664942678523.png)

> 11-选择物体更改名称

​	此外还可对一些模型创建时不明的边角余料碎片进行删除，删除方式是通过右键点击右侧场景列表中的模型，选择【Select Hierarchy】，然后鼠标移回模型视口按键盘delete键进行删除（否则容易仅删除父级空物体而保留子物体）。改名删除冗余模型后场景物体列表如下图所示。

![12-选择物体更改名称-B](说明.assets\12-选择物体更改名称-B-1664943423158.png)

> 12-名称更改、删除冗余模型后模型场景列表

​	除此之外还可通过在Blender创建集合（collection）的方式来对景观元素（模型物体）进行分类量化，以便之后以同一类型进行视觉特征量化。具体方式为先在场景模型列表或视口中选中模型物体，再在模型视口中使用组合键ctrl+m 选择新建集合(【+New Collection】)或加入现有集合。

![14-创建集合](说明.assets\14-创建集合-1664958182471.png)

13-创建集合

​	值得一提的是，**同一个物体可以加入不同的集合**。例如下图所示集合中模型物体“Tree_l”“Tree_s”同时存属于原有集合Collection、新建集合Tree以及Green。表示这两个模型物体所代表的两棵树既是树亦是绿植，在之后“视觉分析”过程中可分别对这两个模型物体以及这两类数据进行指标量化。

![14-创建集合-B](说明.assets\14-创建集合-B.png)

> 14-集合创建结果

​	预处理完毕后，保存文件。

### 2、空间采样

​	待进行视觉分析的研究对象分析一般呈点、线、面三种形式。点对应某一特定观察点，线对应某一条游线，面对应某一边界范围内的所有区域。视觉分析是以某一点的视觉特征为基础进行的分析，因而对于线和面需要将其转化为若干连续、均布的点，依次对每个点进行分析，再根据线、和面对点的组织序列通过对比、插值等方式进行整体特征分析。其中将线和面转化为能够代表其几何特征的点的过程叫做空间采样，采样结果中每一个独立进行视觉分析的点叫做采样点，其分析数据代表了位于该点模型表面具有某一身高的观察者所能感知到的环境视觉特征。

​	空间采样的几何本质是对环境平面上的研究线路、表面转化为代表其几何特征的有序点阵。一般使用CAD与ArcGIS相结合的方式进行采样，其中CAD负责相关平面数据范围的获取，之后在ArcGIS进行采样（最后也通过ArcGIS进行视觉分析后的结果展示）。

#### 2.1 CAD采样范围预处理

​	cad平面图可以通过项目原本的平面或者su导出（如下图）获得。**一定需要注意的是，必须保证cad中的平面坐标与模型中的平面坐标一致。**例如，前文示例su中房子的中心位于坐标原点，则cad中也要以此为参照通过把房子中心调整至坐标原点使得三维与平面坐标一致。

​	本示例选择房子外一周回字形的亲水平台为研究范围，因此新建图层将其标注出。同样需要注意的是，为了避免量化过程中与模型实体产生交错，建议范围边界（特别是房子墙周围的）**一定要向远离实体的方向进行一个微小的偏离（offset）**，这样就不会在分析的过程中产生因为紧贴墙皮而一半室内、一半室外还有一部分在墙里的尴尬现象。

![1-CAD处理编辑](说明.assets\1-CAD处理编辑.png)

> 1-CAD处理编辑

​	此后将范围边界导出为单独文件。若需要cad底图，可再导出一个全部图层文件。

#### 2.2 通过GIS进行平面采样

​	新建ArcMap空白地图。

![2-ArcGIS新建项目](说明.assets\2-ArcGIS新建项目.png)

> 2-ArcGIS新建项目

​	设置适合的坐标投影。鼠标右键点击左侧【内容列表】，选择【属性】，弹出窗口选择【坐标系】标签页。由于国内一般使用“ 2000国家大地坐标系 ”，因而在搜索栏输入“CGCS2000”再根据地方经度选择对应投影坐标系。一般情况下高斯-克吕格投影类的投影坐标系都符合大部分情况下我国cad平面作图的投影习惯。

![3-ArcGIS设置适合投影](说明.assets\3-ArcGIS设置适合投影.png)

> 3-ArcGIS设置适合投影

​	点击下图箭头1位置，添加刚才导出的采样边界dwg文件。每个dwg文件都包含5个不同文件分别存放不同类型的数据。右键点击箭头2位置包含“Polygon”（多边形）的数据。选择【导出数据】，选择使用【数据框】坐标系，并通过箭头3位置选择存储位置以及shapefile（.shp）的存储格式。

![4-导入CAD数据](说明.assets\4-导入CAD数据-1665044778594.png)

> 4-导入CAD数据并导出为shapefile

​	下图内容列表中“region”为刚导出的图形，需要“手工打洞”出原模型中房子所在实体位置。方法为依据下图箭头1-5，在【编辑器】中（若没有则在工具栏点击右键勾选【编辑器】）选择开始编辑，点击视口中的范围在点击箭头3位置，根据捕捉描绘出箭头4所指形状完成分割。选中分割出的图形，delete或右键删除，完成“打洞”。点击【编辑器】箭头5所指位置保存并停止编辑。

![5-裁剪范围](说明.assets\5-裁剪范围-1665044912971.png)

> 5-裁剪范围

​	下图为裁剪后结果。

![6-裁剪结果](说明.assets\6-裁剪结果.png)

> 6-裁剪结果

​	ArcGIS对面域进行采样主要通过【创建渔网】工具。【创建渔网】工具在如下图所示【目录】列表的系统工具箱内，亦可以通过搜索工具进行搜索。双击打开【创建渔网】窗口，在【输出要素类】中选择保存的目录和名称，【模板范围】选择刚裁剪出的边界文件（本示例为“region”图层）。【像元宽度】与【像元高度】决定了采样的间距，即密度。其密度取决于研究范围的大小以及需求的精细度。间距越小，即密度越大，则单位面积的采样点越多，后面视觉分析过程所耗费的时间越长。图中的间距为0.5，其结果在该区域产生了1000+的采样点，若间距为1，则采样点为200+。这里建议设置为1以减少分析时间，本示例后面分析阶段所展示的实际结果亦为宽高间距为1的结果（采样示例所使用的是0.5，但由于过密而没有在后面继续使用）。

![7-创建渔网](说明.assets\7-创建渔网.png)

> 7-创建渔网

​	创建渔网后会发现，我们需要的采样点实际上位于一个尾缀为”label“的图层中。在视口中可以看到部分采样点位于边界之外，因此需要借助【按位置选择】的功能将多余采样点删除。具体过程为：如下图，在【编辑器】中选择开始编辑，选择对应的label图层。

![8-编辑格网点](说明.assets\8-编辑格网点.png)

> 8-编辑格网点

​	在菜单栏中选择【选择】中的【按位置选择】，然后如下图设置弹出窗口，点击【应用】查看是否选中边界范围内的所有点。

![9-按位置选择](说明.assets\9-按位置选择.png)

9-按位置选择

​	在选中范围内采样点的状态下，右键点击采样点图层，选择【打开属性表】，左上角下拉菜单中选择【切换选择】反向选择。此时视口中选中的点应均为边界之外的点。之后点击右上角删除符号，删除边界外采样点。关闭属性表后，在工具栏【编辑器】中保存并关闭编辑器。

![11-删除多余格点](说明.assets\11-删除多余格点.png)

10-属性表反向选择，删除多余采样点

​	下图，为间隔1m的采样点结果。

![15-根据需求调整创建采样点参数至适宜疏密](说明.assets\15-根据需求调整创建采样点参数至适宜疏密.png)

> ​	11 采样点创建结果

​	以上采样点足以满足一般量化需求。但若需要强调边界采样点，可通过下图所示【系统工具箱】中【沿线生成点】如下图所示另生成一个边线的采样点图层。

![12-可根据需求增加边界点](说明.assets\12-可根据需求增加边界点.png)

> 12-可根据需求增加边界采样点

​	若增加边界采样点，需要额外增加合并过程，使得边界内部采样点与边界采样点合二为一。其方式为点击菜单栏【地理处理】，选择【合并】。如下图，通过输入数据集中分别添加两个要合并的图层，选择输出文件目录名称后单击确定合并图层数据。

![13-合并所有点](说明.assets\13-合并所有点.png)

> 13-合并所有采样点信息

​	此时的采样点文件虽然本身具有空间位置信息，但并为展示在图层属性表中，也就无法以表格的形式导出。因而需要通过【系统工具箱】中的【添加XY】坐标工具，如下图选择（合并后的）采样点图层天际XY坐标，此时图层要素的属性表中已包含X、Y等坐标信息。若模型表面有高程，可新增ELEVATION或Z值字段，通过手动录入或表面栅格（DEM）采集的方式获取该位置的表面高程信息。

![14-添加XY坐标](说明.assets\14-添加XY坐标.png)

> 14-添加XY坐标

​	将属性表数据导出为CSV表格数据。打开采样点图层要素属性表，在左上角菜单目录中选择导出（箭头1位置），箭头2位置打开【保存数据】选项，找到要保存的文件夹位置，将最下方【保存类型】设置为“文本文件”，名称命名为.csv格式，单击保存，输出采样点表格数据。

![16-导出采样点CSV文件](说明.assets\16-导出采样点CSV文件.png)

> 15-导出采样点CSV文件

#### 2.3 EXCEL格式化整理采样点数据

​	导出的csv格式采样点表格数据可通过EXCEL打开查看。打开后可以发现里面包含了诸多无用属性，为了下一步视觉分析使用，须如下图按照”ID-X-Y-Z“的顺序调整列序，表头名称无硬性规定。这里的”ELEVATION“为高程信息，若无则以0填充。保存后可进入下一阶段视觉分析。

![17-使用EXCEL调整CSV表格顺序](说明.assets\17-使用EXCEL调整CSV表格顺序-1665113669639.png)

### 3、视觉分析

​	视觉分析阶段是对以上构建的模型和采样点数据集进行视觉分析的过程。分析主要通过本人编写的**Env_ViewP.exe**程序实现。除了环境模型（.blend）与采样点（.csv）文件外还需本人根据需要进行编译的Blender程序。示例仅展示一般步骤流程，以下步骤中的专业术语、视觉分析的原理以及软件的构架算法详见本人博士学位论文和发表的相关期刊论文，这里不复赘述。

#### 3.1 加载基本文件数据

​	打开**Env_ViewP.exe**，在【Blender程序位置】找到并加载本人提供的编译后的Blender.exe程序。

<img src="说明.assets\1-打开viewper.exe加载blender.exe位置.png" alt="1-打开viewper.exe加载blender.exe位置" style="zoom:80%;" />

> 1-打开viewper.exe加载blender.exe位置

​	在【Blender模型位置】中加载之前处理好的.blend格式环境模型。

<img src="说明.assets\2-加载构建的环境模型.png" alt="2-加载构建的环境模型" style="zoom:80%;" />

> 2-加载构建的环境模型

​	在【选择项目位置】处选择选择一个空的文件夹（或者是要继续进行或覆盖掉的之前项目文件夹）作为过程文件和结果的输出位置。

<img src="说明.assets\3-选取、新建项目过程与结果文件目录.png" alt="3-选取、新建项目过程与结果文件目录" style="zoom:80%;" />

> 3-选取、新建项目过程与结果文件目录

​	若在该文件夹下检测到之前项目则会出现下图所示弹窗选项，选择【覆盖】则清除之前所有项目信息，选择继续则加载该目录下的项目信息（下方“项目状态”部分会显示加载项目状态）。

<img src="说明.assets\3-选取、新建项目过程与结果文件目录-B.png" alt="3-选取、新建项目过程与结果文件目录-B" style="zoom:80%;" />

> 4-覆盖、继续现有项目

​	在【采样点文件位置】栏加载之前“空间采样”部分创建的采样点.csv文件，加载完成后，下面“采样点信息”会显示载入的采样点数量。

<img src="说明.assets\4-加载采样点.png" alt="4-加载采样点" style="zoom:80%;" />

> 5-加载采样点

​	点击【设置基本参数】可调整视觉分析时对空间进行转化的基本参数。其中须简单说明的是【垂直采样数】为模拟视觉进行光线追踪过程中数值方向的主射线数，而横向主射线数默认为竖向的两倍，则当【垂直采样数】数为720时，总光线数为720*1440（与显示屏分辨率的概念类似），光线数越多则计算速度越慢。而【多进程并行数】则决定了参与计算的计算机CPU核心数，上限为使用者当前计算机核心总数，数值越大计算效率越高，设备的负载也越大。

<img src="说明.assets\5-设置观察点基本参数.png" alt="5-设置观察点基本参数" style="zoom:80%;" />

> 6-设置观察点基本参数

#### 3.2 添加视野

​	视野是量化过程中对人视觉画面有界性的模拟，视野边界的存在才使得同一观察点不同方向上景观的差异。当前支持以下六种视野，其中全域视野和标准全域视野无方向性，标准全域视野可视为水平方向角度为360度的棱锥视野。圆锥视野是模拟人视觉画面的成像特点，棱锥视野是为了方便以四至边界的形式描述视觉范围。圆锥、棱锥视野的连续量化是以特定角度对该采样点进行连续的量化并进一步的比较，从而获得同一采样点不同朝向视觉特征的差异性。

<img src="说明.assets\image-20221007201513914.png" alt="image-20221007201513914" style="zoom:80%;" />

<img src="说明.assets\image-20221007201453637.png" alt="image-20221007201453637" style="zoom:80%;" />

<img src="说明.assets\image-20221007201601437.png" alt="image-20221007201601437" style="zoom:80%;" />

> 7-几种主要视野类型

​	软件自带全域视野（Panaroma），可通过下方【视野控制】标签页增加各类自定义视野。以下为添加“棱锥视野”的方法。首先通过箭头1处激活自定义视野，再通过箭头2处按钮增加棱锥视野，弹出窗口中须自定义视野名称（建议不要太长，否则输出结果excel标签页无法显示）。下方【棱锥视野四至边界角】为棱锥视野的范围，若左右均为180度则为上图标准全域视野。

<img src="说明.assets\6-添加标准全域视野.png" alt="6-添加标准全域视野" style="zoom:80%;" />

> 8-添加标准全域视野

​	若视野非全域类视野，则应有一定的朝向，固定朝向与【设置基本参数】中【x_正轴朝向】设置有关。此外还支棱锥视野始终朝向视野中某一物体或集合的动态视野设置。其设置方法为激活视野面板中的【朝向追踪】设置项，在弹出窗口中可以选择一个或多个的物体或集合作为该有界视野的朝向。当该采样点中无该追踪物体时，视野朝向选用原固定朝向。

<img src="说明.assets\7-增加朝向追踪物体.png" alt="7-增加朝向追踪物体" style="zoom:80%;" />

> 9-增加朝向追踪物体

​	增加圆锥视野与增加棱锥视野的方法相类似，区别是在【圆锥视野四至边界角】的面板增加了确保圆锥形状的边界角锁定。下图为锥角为60度，始终以视觉画面中模型中石头所在方向为朝向的自定义圆锥视野设置方式。

<img src="说明.assets\7-增加圆锥朝向追踪视野.png" alt="7-增加圆锥朝向追踪视野" style="zoom:80%;" />

> 10-增加圆锥朝向追踪视野

​	添加连续视野的设置基本与棱锥、圆锥视野相似，增加【视野类型】选项可手动切换“棱锥”与“圆锥”两种不同连续视野基准。【朝向总数】为等分一周（360度）的数量，图中数值36为每个采样点旋转36次，每次旋转10度。【四至边界角】面板中的朝向追踪选项设置为旋转过程中其实位置的朝向，若不设置则为设置的默认朝向。

<img src="说明.assets\8-添加连续视野.png" alt="8-添加连续视野" style="zoom:80%;" />

> 11-添加连续视野

#### 3.3 添加物体指标

​	视野设置完成后设置具体要量化的特征，特征分为两类：一类是以环境模型中设置的物体或集合为量化对象的个体特征，另一类特征为忽略物体个体异质性反映环境整体特征的整体特征。个体特征的添加方式主要分为两种，一种是将所选物体和集合全部**合并**为同一自定义物体进行视觉指标量化的【添加物体指标】，另一种是将各选中集合**分别**量化为相同指标的【添加集合指标】。下图为添加物体指标的方法。在指标设置窗口中，【选择物体】中选中的所有物体和集合将在量化中合并为名称为【对象名称】中设置的同一物体；【视野控制】可选择一个或多个需要进行下方指标量化的视野，若不选择则默认为全域视野；【当前参数】为可编辑的现阶段状态，将其复制后可在相同弹窗中复制并载入。

<img src="说明.assets\9-添加物体视觉指标.png" alt="9-添加物体视觉指标" style="zoom:80%;" />

> 12-添加物体视觉指标

#### 3.4 添加整体指标

​	整体特征的设置方式基本与个体特征一致。

<img src="说明.assets\10-添加整体指标.png" alt="10-添加整体指标" style="zoom:80%;" />

> 13-添加整体指标

#### 3.5 启动分析与分析结果

​	完成视野、特征设置后可在各自面板中选择【保存】按钮进行设置保存，之后可通过【加载】按钮加载之前的设置。所有设置完成后可在最下方点击【开始运算】按钮开始进行计算。其上方【保留视觉矩阵选项】为保存环境视觉转换过程中的过程文件。若不改变模型和参数，仅改变视野和特征设置，勾选该项可大大减少第二次计算消耗的时间（但会占据一定的硬盘空间）。运算开始后，命令行窗口会显示计算过程。

![11-开始计算](说明.assets\11-开始计算.png)

> 14-开始计算

​	计算结束后会弹出结果窗口，该文件夹位于之前设置的【项目位置】中。其中包含的.xlsx文件为结果。根据视野和指标选择情况，最多会出现四个结果文件：Object_SGL_Result、Overall_SGL_Result分别为个体特征和整体特征在单一（非连续）视野中的量化结果，Object_SEQ_Result、Overall_SEQ_Result为个体特征和整体特征在连续视野中的量化结果（本示例在整体特征量化设置中未勾选连续视野，因而只有三个结果文件）。其他文件：log文件夹内为量化日志文件、settings文件夹为本次量化视野与个体特征的设置文件，可在各自量化设置面板中通过【加载】重复使用。

<img src="说明.assets\12-计算结束.png" alt="12-计算结束" style="zoom:80%;" />

> 15-计算结束

### 4、常用数据可视化方法

​	视觉量化的数据存于固定四个xlsx文件，可以通过EXCEL打开查看。但对于面向空间设计的建筑、规划与风景园林习惯以空间表述上更为直观的方式进行展示。以下以EXCEL和ArcGIS矢量箭头作为连续视野指标展示示例，以ArcGIS数据栅格化作为单一视野指标展示示例。

#### 4.1 结果文件数据说明

​	以.xlsx为格式的数据结果可分为单一视野（文件名中间带有“SGL”）和连续视野（文件名中间带有“SEQ”）两类。下图为个体特征单一视野的量化结果。底部工作表标签栏（标号1处）为不同的视野，包含了默认的“PANAROMA”以及之前设置的各类自定义视野，而表格则为不同视野下量化的结果。标签名称所带表视野的含义，以”OB_2_SGL_CON_T_60D“为例：“OB”代表个体指标（整体指标为”OV“，”2“代表视野编号（设置自定义视野时自动追加，之前视野设置面板中有显示），”SGL“代表单一（非连续，连续为”SEQ“）视野，”CON“代表圆锥视野（棱锥为”PYR“，全域为”PAN“），”T“（代物体追踪，若非物体追踪则无此符号），”60D“为之前自定义的名称（全域视野为默认的”PANAROMA“）。

​	在**单一视野**中，表格栏中为该视野下的指标量化结果，以”OB_2_SGL_CON_T_60D“为例。其中标号2里的内容对应之前采样点的信息，其中“POINT_Z"为原高程信息加上之前分析”加载基本文件数据“阶段【设置基本参数】中设置的”观察点高度“。标号3中为带有物体追踪的视野此时物体追踪的水平（H，Horizotal）角和俯仰（V，vertical）角，若非物体追踪则无这两列内容。标号4为具体指标，若同时量化多类指标则会有多个。指标”1_pond(Pond)_sa“名称含义为：”1“为指标编号，pond(Pond)前部分为自定义指标名称，括号中为指标包含物体内容提示，”sa“为具体的量化指标（这里是立体角）。

![3-SGL指标结果展示-B（带追踪）](说明.assets\3-SGL指标结果展示-B（带追踪）.png)

> 1-SGL指标结果展示（带追踪）

​	在**连续视野**结果中，以物体指标连续视野为例。不同于单一视野，连续视野的每个视野的每个具体指标都要使用单独的一个表格输出结果，因而下方标签页对应的是某个视野某一指标。标签页名称的具体含义，以“OB_SEQ_3_Ind1_sa”为例：“OB”代表物体指标，“SEQ”代表连续视野，“3”代表视野编号，“Ind1”代表指标编号1，“sa”为具体指标。

​	数值表格中，下图标号1为采样点信息，标号2为物体追踪信息。标号3为连续视野统计信息：“Orient_Max”、“Orient_Max_Value”为最大数值朝向，以及该朝向指标大小（最大数值）；“Orient_N-Min”、“Orient_N-Min_Value”为非零最小数值朝向，以及该朝向指标大小（最小非零数值）；“Orient_Min”、“Orient_Min_Value”为最小数值朝向，以及该朝向指标大小（最小数值）。标号3则为各朝向的具体数值，其表头名称”+xx“为旋转角度。

![1-SEQ指标结果展示](说明.assets\1-SEQ指标结果展示.png)

> 2-SEQ指标结果展示

#### 4.2 连续视野的EXCEL雷达图展示

​	对于连续视野中的各朝向数值可以通过EXCEL雷达图的形式予以展示，用以具体分析环境中某一位置某一视觉特征的各朝向差异以及变化规律。具体操作方式如下图所示。

![2-SEQ雷达图](说明.assets\2-SEQ雷达图.png)

> 3-SEQ雷达图

#### 4.3 ArcGIS数据栅格化展示

​	在建筑、规划和风景园林的研究和实践领域，更多的数据还是期望以ArcGIS中类似传统坡度、高程分析一样以栅格数据进行展示，以便与其他数据结合，融入涵盖面更为广泛的设计与研究中。以下以上述环境模型中全域视野的池塘（pond）的立体角大小（sa，视觉大小）的栅格量化为例，展示视觉量化在ArcGIS数据栅格化展示的一般方法。

​	首先打开“空间采样”过程中创建的ArcGIS文件（包含了之前的边界数据与空间投影）。以下图所示步骤加载Object_SGL_Result.xlsx中“OB_0_SGL_PAN_PANOROMA”标签页的表格内容。

![4-ArcGIS打开一般指标](说明.assets\4-ArcGIS打开一般指标.png)

> 4-ArcGIS加载.xlsx中的标签页表格

​	尽管表格中带有坐标，但是ArcGIS无法自动识别，须按照下图所示方法【显示XY数据】使GIS系统识别坐标字段。

![5-显示坐标数据](说明.assets\5-显示坐标数据.png)

> 5-显示坐标数据

​	加载完成地理数据后，可以在视口中以点的形式看到相关数据位置（同采样点一致）。此时如下图所示方法可通过插值的方式进行该视野下 某一指标的视觉特征栅格展示。

![6-栅格插值](说明.assets\6-栅格插值.png)

> 6-栅格插值

​	以下为栅格量化结果，符合一般展示期望，但仍存在部分问题：其一，栅格结果显示不够精细；其二，插值形状不符合原边界。

![7-栅格结果](说明.assets\7-栅格结果.png)

> 7-栅格结果

​	显示精度问题可使用增加分类数或如下图所示色带拉伸的方式予以细节展示。

![7-栅格结果-B 调整色带](说明.assets\7-栅格结果-B 调整色带.png)

> 8-调整色带

​	而边界可通过下图所示图层右键（调坐标投影的窗口），在【数据框】中通过裁剪选项以原边界图层作为【指定形状】对栅格数据进行裁剪的方式予以实现。若有图层不想受裁剪影响可通过【排除图层】设置例外。

![7-栅格结果-C 图层裁剪](说明.assets\7-栅格结果-C 图层裁剪.png)

> 9-图层裁剪

​	以下为改进后的结果。下图显示的就是在该区域内人视野中池塘大小的变化情况，可据此配置相关滨水游憩设施。**这种最基本的分析便能转化为若干实用成果与创新研究。**

![8-改进结果](说明.assets\8-改进结果.png)

> 10-改进结果

#### 4.4 ArcGIS矢量箭头展示

​	连续视野量化结果中同时包含了数值和方向两种数据，若单纯实用栅格来表述一方面不够直观，另一方面在数据维度上也无法支持。因此可以实用矢量箭头的方式对其进行展示。具体方法如下。

​	首先如栅格展示一样先加载对应数据表，并显示XY数据。	![9-添加SEQ数据](说明.assets\9-添加SEQ数据.png)

> 11-添加SEQ数据

​	在视口中看到的“点”实际上是一种圆形符号，需要的是以一种有向的箭头符号来表示方向，并以其符号的大小来表示该方向视觉指标数值的大小。由于ArcGIS没有默认的箭头符号，因而需要如下图所示步骤自定义编辑箭头符号。

![10-设置箭头符号](说明.assets\10-设置箭头符号.png)

> 12-设置箭头符号

​	而调整旋转角度与大小则是通过【符号系统】中的高级选项如下图依次显示。在调整方向时，由于我们在视觉分析过程中【设置基本参数】中选择默认北方向为“x_正轴朝向”，因而“Orient_Max”的数值可以直接选择“地理”作为旋转方向。而在调整大小时，由于“Orient_Max_Value"的数值过小，因而需要在【表达式构建器】中根据情况乘以10作为符号大小数值。

![10-设置箭头符号朝向与大小](说明.assets\10-设置箭头符号朝向与大小.png)

> 13-设置箭头符号朝向与大小

​	设置完成后，会发现一部分箭头被边界裁剪，可通过上述【排除图层】将箭头数据图层排除裁剪之外。以下为展示成果，其中箭头的朝向代表了该位置池塘视觉面积最大的朝向，而箭头的大小表示了视觉中池塘的大小。可以据此进行朝向优化相关的设计与研究。

![11-成果展示](说明.assets\11-成果展示.png)

> 14-成果展示
